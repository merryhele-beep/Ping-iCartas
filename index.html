<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>Ping√ºiCartas: Mensajer√≠a Polar üêßüíå</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        :root {
            --rosa: #ff6fb0;
            --azul-claro: #a8e6ff;
            --blanco: #ffffff;
            --texto: #2c3e50;
        }

        /* --- MODO D√çA/NOCHE AUTOM√ÅTICO --- */
        body {
            transition: background 2s ease, color 0.5s ease;
            min-height: 100vh;
            margin: 0;
            font-family: 'Segoe UI', system-ui, sans-serif;
            overflow-x: hidden;
        }

        /* Ma√±ana */
        body.manana { background: linear-gradient(var(--azul-claro), var(--blanco)); color: var(--texto); }
        /* Tarde */
        body.tarde { background: linear-gradient(#4ab3ff, var(--azul-claro)); color: var(--texto); }
        /* Noche */
        body.noche { background: linear-gradient(#0f2027, #203a43); color: var(--blanco); }

        header {
            background: rgba(255, 111, 176, 0.8);
            backdrop-filter: blur(5px);
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 28px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        /* --- EDITOR PRO (Glassmorphism) --- */
        #editor {
            margin: 20px auto;
            max-width: 600px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(15px);
            border-radius: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
            transition: opacity 0.8s;
        }

        body.noche #editor {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        textarea {
            width: 90%;
            height: 120px;
            border-radius: 20px;
            border: 2px solid var(--rosa);
            padding: 15px;
            font-size: 16px;
            outline: none;
            background: rgba(255,255,255,0.8);
        }

        .seccion-sellos { margin: 15px 0; }
        .sello-btn {
            font-size: 25px;
            cursor: pointer;
            padding: 10px;
            transition: transform 0.2s;
            display: inline-block;
        }
        .sello-btn.selected { transform: scale(1.3); }

        button {
            padding: 15px 30px;
            margin: 10px;
            border: none;
            border-radius: 50px;
            background: var(--rosa);
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(255, 111, 176, 0.4); }

        /* --- ESCENARIO --- */
        #escenario {
            height: 250px;
            position: relative;
            overflow: hidden;
        }

        #pinguinoContainer {
            position: absolute;
            left: 5%;
            top: 100px;
            font-size: 60px;
            transition: left 3.5s cubic-bezier(0.65, 0, 0.35, 1);
            display: flex;
            align-items: center;
            z-index: 5;
        }

        #buzon {
            position: absolute;
            right: 10%;
            top: 100px;
            font-size: 60px;
        }

        .caminar { left: calc(85% - 50px) !important; }

        /* --- NIEVE --- */
        .copo { position: fixed; top: -10px; color: white; user-select: none; pointer-events: none; z-index: 1; }
    </style>
</head>
<body>

<header>Ping√ºiCartas üêß</header>

<div id="editor">
    <h3>Escribe tu mensaje</h3>
    <textarea id="textoCarta" placeholder="Querido/a..."></textarea>
    
    <h3>Elige un sello</h3>
    <div class="seccion-sellos">
        <span class="sello-btn selected" onclick="cambiarSello(this, '‚ù§Ô∏è')">‚ù§Ô∏è</span>
        <span class="sello-btn" onclick="cambiarSello(this, '‚≠ê')">‚≠ê</span>
        <span class="sello-btn" onclick="cambiarSello(this, 'üçÄ')">üçÄ</span>
    </div>
    
    <button onclick="enviarCarta()">¬°Entregar! ‚û°Ô∏èüìÆ</button>
</div>

<div id="escenario">
    <div id="pinguinoContainer">
        <span>üêß</span>
        <span id="sobreVisual">‚úâÔ∏è<span id="selloEnSobre" style="font-size:15px; position:absolute; top:15px; left:18px;">‚ù§Ô∏è</span></span>
    </div>
    <div id="buzon">üìÆ</div>
</div>

<div id="botonesFinales" style="text-align:center; display:none; padding-bottom:30px;">
    <button onclick="descargarPDF()" style="background: #4ab3ff;">Descargar PDF Pro üìÑ</button>
    <button onclick="location.reload()" style="background: #999;">Crear Otra</button>
</div>

<script>
    let selloSeleccionado = "‚ù§Ô∏è";

    // --- 1. L√ìGICA DE HORAS (CAMBIO DE FONDO) ---
    function actualizarFondoPorHora() {
        const hora = new Date().getHours();
        const body = document.body;
        body.classList.remove('manana', 'tarde', 'noche');

        if (hora >= 6 && hora < 12) body.classList.add('manana');
        else if (hora >= 12 && hora < 19) body.classList.add('tarde');
        else body.classList.add('noche');
    }
    actualizarFondoPorHora();
    setInterval(actualizarFondoPorHora, 60000); // Revisar cada minuto

    // --- 2. EFECTO NIEVE ---
    setInterval(() => {
        const copo = document.createElement("div");
        copo.className = "copo";
        copo.innerHTML = "‚ùÑÔ∏è";
        copo.style.left = Math.random() * 100 + "vw";
        copo.style.fontSize = Math.random() * 15 + 5 + "px";
        const d = Math.random() * 3 + 2;
        copo.style.transition = `top ${d}s linear`;
        document.body.appendChild(copo);
        setTimeout(() => { copo.style.top = "100vh"; }, 100);
        setTimeout(() => { copo.remove(); }, d * 1000);
    }, 200);

    // --- 3. SELECCI√ìN DE SELLO ---
    function cambiarSello(elemento, emoji) {
        document.querySelectorAll('.sello-btn').forEach(b => b.classList.remove('selected'));
        elemento.classList.add('selected');
        selloSeleccionado = emoji;
        document.getElementById('selloEnSobre').innerText = emoji;
    }

    // --- 4. ANIMACI√ìN DE ENTREGA ---
    function enviarCarta() {
        const t = document.getElementById("textoCarta").value;
        if(!t.trim()) return alert("¬°Escribe algo primero!");

        document.getElementById("editor").style.display = "none";
        document.getElementById("pinguinoContainer").classList.add("caminar");

        setTimeout(() => {
            document.getElementById("sobreVisual").style.opacity = "0";
            document.getElementById("buzon").innerHTML = "üì¨";
        }, 3500);

        setTimeout(() => {
            document.getElementById("botonesFinales").style.display = "block";
        }, 4000);
    }

    // --- 5. GENERACI√ìN DE PDF PRO ---
    function descargarPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        let texto = document.getElementById("textoCarta").value;
        
        // Limpiar emojis para PDF
        const textoLimpio = texto.replace(/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g, '');

        // Doble borde
        doc.setDrawColor(255, 111, 176); // Rosa
        doc.setLineWidth(2);
        doc.rect(10, 10, 190, 277); 
        doc.setDrawColor(200, 200, 200); // Gris
        doc.setLineWidth(0.5);
        doc.rect(13, 13, 184, 271); 

        // T√≠tulo
        doc.setFont("helvetica", "bold");
        doc.setFontSize(28);
        doc.setTextColor(255, 111, 176);
        doc.text("Ping√ºiCartas", 105, 30, { align: "center" });

        // Mensaje
        doc.setFont("times", "normal");
        doc.setFontSize(16);
        doc.setTextColor(50, 50, 50);
        
        const lineas = doc.splitTextToSize(textoLimpio, 160);
        doc.text(lineas, 25, 50);

        doc.save("Mi_Pinguicarta.pdf");
    }
</script>

</body>
</html>